<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Code Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .controls {
      margin-bottom: 20px;
    }
    .qr-container {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
    .qr-card {
      border: 1px solid #ccc;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      width: 3.5cm;
      height: 3.5cm;
    }
    .qr-card h3 {
      margin: 5px 0;
      font-size: 14px;
      text-align: center;
    }
    .qr-card p {
      margin: 0;
      font-size: 12px;
      text-align: center;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      .print-area, .print-area * {
        visibility: visible;
      }
      .print-area {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        page-break-inside: avoid;
      }
    }
      .label-controls { margin-top: 8px; }
    .hidden { display:none; }
</style>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</head>
<body>
  <h1>QR Code Generator</h1>

  <div class="controls">
    <label>Title: <input type="text" id="qr-title" /></label><br /><br />
    <label>Description: <input type="text" id="qr-description" /></label><br /><br />
    <label>Enter text for QR: <input type="text" id="qr-input" /></label><br /><br />
    <label>How many QR codes on paper (1-20):</label><br />
    <div id="qr-count-options"></div>
    <br />
    <button onclick="generateQR()">Generate QR</button>
    <button onclick="window.print()">Normal Yazdır</button>
    <button onclick="printCab()">CAB EOS 5 Yazdır</button>
    <button onclick="printArgox()">Argox OS-214plus Yazdır</button>
    <button onclick="printBartender()">Bartender ile Yazdır</button>

    <div class="label-controls">
      <hr style="margin:16px 0;"/>
      <strong>35×35 mm Etiket Yazdır (doğrudan barkod yazıcıya):</strong><br/>
      <label>Kopya Sayısı: <input type="number" id="label-copies" value="1" min="1" max="999" style="width:80px"></label>
      <button onclick="printLabel35mm()">35×35 mm Etiket Yazdır</button>
      <div style="font-size:12px;opacity:0.8;margin-top:6px">Yazdırma penceresinde ölçek %100, kenar boşluğu 0 olmalı. Tarayıcı başlık/altbilgi kapalı olmalı.</div>
    </div>
  </div>
    <br />
    <button onclick="generateQR()">Generate QR</button>
    <button onclick="window.print()">Normal Yazdır</button>
    <button onclick="printCab()">CAB EOS 5 Yazdır</button>
    <button onclick="printArgox()">Argox OS-214plus Yazdır</button>
    <button onclick="printBartender()">Bartender ile Yazdır</button>
  </div>

  <div id="qr-output" class="qr-container print-area"></div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
<script>
  const qrCountOptions = document.getElementById('qr-count-options');
  for (let i = 1; i <= 20; i++) {
    const label = document.createElement('label');
    label.innerHTML = `<input type="radio" name="qr-count" value="${i}" ${i === 1 ? 'checked' : ''}/> ${i}`;
    label.style.marginRight = '8px';
    qrCountOptions.appendChild(label);
  }

  function generateQR() {
    const container = document.getElementById('qr-output');
    container.innerHTML = '';

    const text = document.getElementById('qr-input').value;
    const title = document.getElementById('qr-title').value;
    const description = document.getElementById('qr-description').value;
    const count = parseInt(document.querySelector('input[name="qr-count"]:checked').value);

    for (let i = 0; i < count; i++) {
      const card = document.createElement('div');
      card.classList.add('qr-card');

      const canvas = document.createElement('canvas');
      QRCode.toCanvas(canvas, text, { width: 180, margin: 1 }, function (error) {
        if (error) console.error(error);
      });

      const titleEl = document.createElement('h3');
      titleEl.textContent = title;

      const descEl = document.createElement('p');
      descEl.textContent = description;

      card.appendChild(canvas);
      if (title) card.appendChild(titleEl);
      if (description) card.appendChild(descEl);

      container.appendChild(card);
    }
  }

  function printCab() {
    const text = document.getElementById('qr-input').value;
    alert("CAB EOS 5 yazıcıya gönderilecek komut: (örnek)
— Cablabel/JS ile gerçek gönderim için backend gerekir.");
  }

  function printArgox() {
    const text = document.getElementById('qr-input').value;
    alert("Argox OS-214plus yazıcıya gönderilecek komut: (örnek)
— Gerçek gönderim için backend gerekir.");
  }

  function printBartender() {
    const text = document.getElementById('qr-input').value;
    fetch('/print-bartender', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content: text })
    }).then(()=>alert('Bartender yazdırma isteği gönderildi (backend gerekli).'))
      .catch(err => alert('Hata: ' + err));
  }

  // --- 35×35 mm LABEL PRINT (no backend) ---
  function openLabelWindow(html) {
    const w = window.open('', '_blank');
    w.document.open();
    w.document.write(html);
    w.document.close();
  }

  function printLabel35mm() {
    const text = document.getElementById('qr-input').value || '';
    const copies = Math.max(1, Math.min(999, parseInt(document.getElementById('label-copies').value || '1')));

    // Create one QR (high res) then reuse as image
    const canvas = document.createElement('canvas');
    // 35mm ≈ 1.378 in; @300dpi ≈ 413px. Biraz yüksek tutalım.
    const px = 420;
    return QRCode.toCanvas(canvas, text, { width: px, margin: 0 }, function () {
      const dataUrl = canvas.toDataURL('image/png');
      const labelHTML = `<!DOCTYPE html>
<html><head><meta charset="utf-8"/>
<style>
  @page { size: 35mm 35mm; margin: 0; }
  html, body { margin:0; padding:0; }
  .label { width:35mm; height:35mm; page-break-after: always; display:flex; align-items:center; justify-content:center; }
  img { width:35mm; height:35mm; display:block; }
</style>
</head>
<body>
  ${Array.from({length: copies}).map(()=>`<div class="label"><img src='${dataUrl}' alt='QR'/></div>`).join('')}
  <script>window.onload = function(){ window.focus(); window.print(); }</script>
</body></html>`;
      openLabelWindow(labelHTML);
    });
  }
</script>
</body>
</html>
